# AlbumManagerLite

**AlbumManagerLite** — настольное приложение на **JavaFX**, использующее файловую систему Windows в качестве базы данных.
Оно позволяет объединять файловые ресурсы разных типов в **проекты**, а проекты — в **альбомы**.
Каждый объект в системе — ресурс, проект, альбом, представление, импорт — имеет собственный **UUID**, по которому его можно однозначно идентифицировать и на который ссылаются другие объекты.
При создании любого объекта автоматически создаётся **журнал**; его файл хранится рядом с метаданными и имеет то же имя `<UUID>.yaml`.

Приложение предназначено для **музыкантов**, **художников** и других творческих пользователей.

---

## 1. Ресурсы

Основой работы приложения является **ресурс**. Это неизменяемый объект, описывающий импортированный файл.
Ресурсами могут быть:

- **Track** — аудиофайл (`.wav`, `.mp3`, `.flac`, `.aiff`, `.ogg`)
- **Image** — изображение (`.png`, `.jpeg`, `.jpg`)
- **MIDI** — последовательность MIDI (`.mid`, `.midi`)
- **Video** — видеофайл (`.mp4`, `.mov`, `.mkv`)

Каждый ресурс описывается YAML-файлом `metadata/resource/<UUID>.yaml` со структурой:

```yaml
hash: <sha256>
resourceType: <enum>      # enum[track, image, midi, video]
inFolder: <boolean>
extension: <enum>          # расширение исходного файла
sizeBytes: <int>
importedAt: "<datetime>"
created: "<datetime>"
modified: "<datetime>"
tags:
  - <string>
metadata:
  <meta-key>: <meta-value>
```

Теги существуют только у ресурсов: они описывают содержимое неизменяемого файла и используются для фильтрации и представлений.
Поле `inFolder` помечает ресурсы, импортированные из папок проектов (`folder`), что позволяет интерфейсу отличать версии треков от
обычных импортаций.

---

## 2. Импорт ресурсов

Автоматический импорт разделён на два сценария, каждый из которых хранит собственные настройки в каталоге `metadata`.

### Import — сканирование библиотеки

Файлы `metadata/import/<UUID>.yaml` описывают корневые папки, из которых приложение забирает материалы при обновлении медиатеки.

- `path` — абсолютный путь к папке, которую нужно сканировать.
- `resourceTypes` — (опционально) перечень типов ресурсов, которые следует импортировать.
- `importedAt` — отметка времени первого сканирования.

При обновлении такая папка обходится рекурсивно: импортируются все поддерживаемые файлы из неё и всех вложенных каталогов. Ресурсы, полученные таким образом, не получают дополнительных маркеров — это обычные элементы медиатеки.

Пример шаблона:

```yaml
id: "..."
path: "D:/Sound Library"
importedAt: 1700000000000
resourceTypes:
  - TRACK
  - IMAGE
```

### Folder — проекты DAW

Файлы `metadata/folder/<UUID>.yaml` описывают конкретные папки с версиями одного трека (например, `demo_v1`, `demo_v2`).

- `path` — абсолютный путь к папке проекта.
- `resourceType` — единственный тип ресурсов, который следует импортировать из этой папки.
- `importedAt` — время первого сканирования.
- `view` — UUID ресурса, который должен отображаться как текущая версия; если поле пустое, приложение выбирает самую свежую версию автоматически.

Такие папки не сканируют подпапки: импортируются только файлы, лежащие непосредственно в указанной директории. Чтобы подхватить несколько типов ресурсов из одного проекта, создаётся несколько независимых объектов `folder`.

При первом добавлении папки система импортирует все отсутствующие файлы и помечает созданные ресурсы флагом `inFolder = true`, что помогает отличать версии треков от остальных импортов.

---

## 3. View (представления)

View — сохранённый фильтр для списка ресурсов.
Файл `metadata/view/<UUID>.yaml` содержит параметры выбора и сортировки:

```yaml
name: "<string>"
included:
  tags:
    - "<string>"
  types:
    - "<enum>"            # enum[TRACK, IMAGE, MIDI, VIDEO]
  extensions:
    - "<enum>"
excluded:
  tags: []
  types: []
  extensions: []
name-contains:
  - "<substring>"
duration-range:
  min: <float>
  max: <float>
sort:
  by: <enum>               # enum[BY_NAME, BY_CREATED_AT, BY_IMPORTED_AT]
  order: <enum>            # enum[ASC, DESC]
```

View не копирует ресурсы, а только настраивает фильтрацию по их свойствам и тегам.

---

## 4. Проекты

**Проект** — виртуальная коллекция ресурсов, отражающая активную работу пользователя.
В YAML-файле `metadata/project/<UUID>.yaml` хранятся ключевые свойства:

```yaml
name: "<string>"
status: <enum>               # enum[CREATED, INPROGRESS, COMPLETED, FROZEN, CANCELED, RELEASED]
resources:
  - <uuid>                   # ссылки на ресурсы по их UUID
createdAt: "<datetime>"
description: "<string>"
view: <uuid>                 # ресурс-превью (обычно аудио)
```

Проекты ссылками включают только ресурсы; теги для проектов не используются — их роль выполняют ресурсы внутри проекта.

---

## 5. Альбомы

**Альбом** объединяет проекты и ресурсы в логическую публикацию. Метаданные альбома находятся в `metadata/album/<UUID>.yaml`:

```yaml
name: "<string>"
type: <enum>                 # enum[DRAFT, RELEASE]
path: "<string>"
status: <enum>               # enum[CREATED, INPROGRESS, COMPLETED, FROZEN, CANCELED, RELEASED]
resources:
  - <uuid>
createdAt: "<datetime>"
description: "<string>"
wallpaper: <uuid>            # UUID ресурса-изображения
view: <uuid>                 # UUID ресурса-превью
```

В альбоме лежат только ссылки на объекты: ресурсы и проекты идентифицируются по UUID.

---

## 6. Журнал

Каждый объект при создании получает собственный журнал в `metadata/journal/<JOURNAL-UUID>.yaml`. Ссылка на владельца хранится в поле `linked-by`:

```yaml
linked-by: "<uuid>"

"<datetime>":
  type: <enum>        # enum[user, system]
  text: <string>
  attachments:
    - "<uuid>"        # ссылки на ресурсы по UUID
  comment-on: "<datetime>"  # опциональная ссылка на другое сообщение
```

Журнал используется для фиксации системных изменений и пользовательских заметок. Вложения — это ссылки на ресурсы по их UUID.

---

## 7. Теги и их группы

Список доступных тегов и их группировок хранится в `metadata/global/taggroups.yaml`.
Формат файла — словарь «тег → группа». Группы используются интерфейсом для объединения тегов по темам (например, «Темы», «Настроения», «Жанры»). Сами объекты не хранят ссылку на группу — она вычисляется при загрузке.

---

## 8. Устройство базы данных

База данных AlbumManagerLite хранится в папке `AlbumManager/metadata` и состоит из YAML-файлов. Каждый объект — отдельный файл `<UUID>.yaml`. Другие объекты ссылаются друг на друга только по UUID.
Пример структуры (см. каталог `AMDatabase` в репозитории):

```
AlbumManager/
└── metadata/
    ├── album/       # файлы альбомов
    ├── global/      # справочники тегов и прочие глобальные настройки
    ├── import/      # автоматический импорт из библиотек
    ├── folder/      # настройки папок проектов DAW
    ├── journal/     # журналы объектов
    ├── project/     # проекты
    ├── resource/    # ресурсы (неизменяемые файлы)
    └── view/        # сохранённые фильтры
```

- Каждый каталог содержит файлы `<UUID>.yaml`, описывающие конкретный объект.
- Каждый журнал хранится в `metadata/journal/<JOURNAL-UUID>.yaml` и ссылается на владельца через поле `linked-by`.
- Ссылки между объектами выполняются по UUID: например, проект перечисляет UUID ресурсов, а альбом — UUID ресурсов и проектов.

---

© AlbumCreatorLite, 2025
